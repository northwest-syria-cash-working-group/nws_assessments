"0",""
"0","market_impact <- reach %>% "
"0","  filter(!is.na(q278)) %>%"
"0","  mutate(market_impact = strsplit(as.character(q278), "" "")) %>% "
"0","  unnest(market_impact) %>% "
"0","  mutate(market_impact_sort = case_when("
"0","    market_impact %in% c(""Increased_item_prices"", "
"0","                         ""Increased_transport_unaffordability"") ~ ""price_increase"", "
"0","    market_impact %in% c(""Damage_related_safety_concerns_at_market"","
"0","                         ""Market_open_for_reduced_hours"", "
"0","                         ""Market_not_functional_due_to_damage"") ~ ""damaged_not_functional"", "
"0","    market_impact %in% c(""Increased_general_safety_concerns_at_markets"") ~ ""safety_concerns"", "
"0","    market_impact %in% c(""Limited_lack_of_transportation_options"", "
"0","                         ""Increased_item_unavailability"") ~ ""limited_goods_services"", "
"0","    market_impact %in% c(""No_impacts"") ~ ""no_impact"", "
"0","    TRUE ~ ""other"")) %>% "
"0","  select(1:11, q16, market_impact_sort) %>% "
"0","  filter(!is.na(q16)) %>% "
"0","  left_join(locations %>% "
"0","              select(admin4pcode, longitude_x, latitude_y), "
"0","            by = ""admin4pcode"") %>% "
"0","  right_join(pcode3_shape %>%"
"0","               filter(ADM2_EN %in% c(""Harim"", ""Idleb"", ""Jisr-Ash-Shugur"","
"0","                         ""Afrin"", ""Jebel Saman"", ""A'zaz"", ""Jarablus"", ""Al Bab"") &"
"0","                        ADM3_PCODE %in% nw_pcode3),"
"0","             by = c(""admin3pcode"" = ""ADM3_PCODE"")) %>% "
"0","  st_as_sf() %>% "
"0","  ggplot() + "
"0","  geom_sf(size = 0.1, colour = ""grey70"") + "
"0","  geom_jitter(aes(x = longitude_x, "
"0","                 y = latitude_y, "
"0","                 colour = market_impact_sort, "
"0","                 size = q16, "
"0","                 text = paste0(""district: "", district, ""\n"","
"0","                               ""sub_district: "", sub_district, ""\n"", "
"0","                               ""community: "", community, ""\n"", "
"0","                               ""issue: "", market_impact_sort, ""\n"", "
"0","                               ""population: "", format(q16, big.mark = "",""))), "
"0","             shape = 21, stroke = .2) + "
"0","  theme_void() + "
"0","  theme(plot.background = element_rect(fill = ""white"", colour = NA), "
"0","        plot.caption = element_text(hjust = .5), "
"0","        legend.text = element_text(size = 6), "
"0","        legend.title = element_text(size = 8)) + "
"0","  labs(title = ""Earthquake impact on markets, NW Syria (REACH Data)"", "
"0","       colour = ""Market impact"", "
"0","       caption = ""Data from REACH"") + "
"0","  guides(size = ""none"")"
"0",""
"0",""
"0","# I think you need to add another geom_sf layer. surprisingly, the thing doesn't appear too large"
"0","# add a geom_sf layer and import the beneficiary data from another df, don't try and join it all together in one chunk, you're crazy "
"0",""
"0","ggplotly(market_impact, tooltip = c(""text"")) %>% "
"0","  plotly::style(hoveron = ""point"") %>% "
"0","  layout(title = list(text = paste0(""Earthquake impact on markets, NW Syria (REACH data)"", "
"0","                                    ""<br>"", "
"0","                                    ""<sup>"", "
"0","                                    ""Size shows number of persons in community; click and drag to zoom; mouse over for details"")))"
